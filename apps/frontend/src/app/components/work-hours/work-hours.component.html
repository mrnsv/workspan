<!-- Compact Work Hours Display -->
<div class="compact-work-hours">
  
  <!-- Main Content (Always Visible) -->
  <div class="work-hours-content" [class.loading-overlay-active]="loading$ | async">
    
    <!-- Primary Stats Card -->
    <div class="cp-card primary-stats-compact" *ngIf="workHoursStats" [ngClass]="getCyberpunkStatusClass()">
      <div class="stats-header-compact">
        <div class="status-indicator-compact" [ngClass]="getStatusIndicatorClass()">
          <mat-icon class="status-icon-small">{{ getStatusIcon() }}</mat-icon>
        </div>
        <div class="hours-display-compact">
          <span class="hours-value-compact">{{ formatHours(workHoursStats.actualHours) }}</span>
          <span class="hours-label-compact">ACTIVE HOURS</span>
        </div>
        <div class="status-message-compact">{{ getCyberpunkStatusMessage() }}</div>
      </div>
      
      <div class="progress-compact">
        <mat-progress-bar 
          mode="determinate" 
          [value]="workHoursStats.completionPercentage"
          class="progress-bar-compact">
        </mat-progress-bar>
        <span class="progress-text-compact">{{ workHoursStats.completionPercentage | number:'1.0-1' }}% COMPLETE</span>
      </div>
    </div>

    <!-- Stats Grid Compact -->
    <div class="stats-grid-compact" *ngIf="workHoursStats">
      <!-- Actual Required Hours -->
      <div class="stat-card-compact">
        <mat-icon class="stat-icon-compact">schedule</mat-icon>
        <div class="stat-data-compact">
          <span class="stat-label-compact">REQ</span>
          <span class="stat-value-compact">{{ formatHours(workHoursStats.actualRequiredHours) }}</span>
        </div>
      </div>

      <!-- Shortfall Hours -->
      <div class="stat-card-compact warning" *ngIf="workHoursStats.shortfallHours > 0">
        <mat-icon class="stat-icon-compact">warning</mat-icon>
        <div class="stat-data-compact">
          <span class="stat-label-compact">DEF</span>
          <span class="stat-value-compact">{{ formatHours(workHoursStats.shortfallHours) }}</span>
        </div>
      </div>

      <!-- Excess Hours -->
      <div class="stat-card-compact success" *ngIf="workHoursStats.excessHours > 0">
        <mat-icon class="stat-icon-compact">trending_up</mat-icon>
        <div class="stat-data-compact">
          <span class="stat-label-compact">SUR</span>
          <span class="stat-value-compact">{{ formatHours(workHoursStats.excessHours) }}</span>
        </div>
      </div>

      <!-- Working Status -->
      <div class="stat-card-compact" *ngIf="workHoursData" [ngClass]="workHoursData.sessions.isCurrentlyWorking ? 'active' : 'inactive'">
        <mat-icon class="stat-icon-compact">{{ workHoursData.sessions.isCurrentlyWorking ? 'work' : 'home' }}</mat-icon>
        <div class="stat-data-compact">
          <span class="stat-label-compact">STS</span>
          <span class="stat-value-compact">{{ workHoursData.sessions.isCurrentlyWorking ? 'ON' : 'OFF' }}</span>
        </div>
      </div>
    </div>

    <!-- Session Summary Compact -->
    <div class="cp-card session-summary-compact" *ngIf="workHoursData">
      <div class="summary-header-compact">
        <span class="summary-title-compact">SESSION DATA</span>
        <button mat-icon-button class="refresh-btn-compact" (click)="onRefresh()" matTooltip="REFRESH">
          <mat-icon class="refresh-icon-inline">refresh</mat-icon>
        </button>
      </div>
      <div class="summary-stats-compact">
        <div class="summary-item-compact">
          <mat-icon class="summary-icon-compact">swap_vertical_circle</mat-icon>
          <span class="summary-value-compact">{{ workHoursData.totalSwipes }}</span>
          <span class="summary-label-compact">SWIPES</span>
        </div>
        <div class="summary-item-compact">
          <mat-icon class="summary-icon-compact">event_available</mat-icon>
          <span class="summary-value-compact">{{ workHoursData.sessions.swipePairs?.length || 0 }}</span>
          <span class="summary-label-compact">SESSIONS</span>
        </div>
        <div class="summary-item-compact">
          <mat-icon class="summary-icon-compact">access_time</mat-icon>
          <span class="summary-value-compact">{{ workHoursData.sessions.formattedTime }}</span>
          <span class="summary-label-compact">TOTAL</span>
        </div>
      </div>
    </div>

    <!-- Error State -->
    <div class="cp-card error-compact" *ngIf="!workHoursData && !(loading$ | async)">
      <div class="error-header-compact">
        <mat-icon class="error-icon-compact">error_outline</mat-icon>
        <span class="error-title-compact">DATA ERROR</span>
      </div>
      <button mat-raised-button class="retry-btn-compact" (click)="onRefresh()">
        <mat-icon>refresh</mat-icon>
        RETRY
      </button>
    </div>

    <!-- Loading Overlay (appears on top of content) -->
    <div *ngIf="loading$ | async" class="loading-overlay">
      <div class="loading-content">
        <span class="loading-title">{{ loadingMessage$ | async }}</span>
        <mat-spinner diameter="20" class="spinner-small"></mat-spinner>
      </div>
    </div>

  </div>
</div>