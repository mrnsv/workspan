<!-- Compact Work Hours Display -->
<div class="compact-work-hours">
  
  <!-- Main Content (Always Visible) -->
  <div class="work-hours-content">
    
    <!-- Primary Stats Card -->
    <div class="cp-card primary-stats-compact" [ngClass]="getCyberpunkStatusClass()">
      <div class="stats-header-compact">
        <div class="status-indicator-compact" [ngClass]="getStatusIndicatorClass()">
          <mat-icon class="status-icon-small">{{ getStatusIcon() }}</mat-icon>
        </div>
        <div class="hours-display-compact">
          <span class="hours-value-compact">{{ getActiveHoursDisplay() }}</span>
          <span class="hours-label-compact">ACTIVE HOURS</span>
        </div>
        <div class="status-message-compact">{{ getCyberpunkStatusMessage() }}</div>
      </div>
      
      <div class="progress-compact">
        <mat-progress-bar 
          mode="determinate" 
          [value]="getCompletionPercentage()"
          class="progress-bar-compact">
        </mat-progress-bar>
        <span class="progress-text-compact">{{ getCompletionPercentageText() }}</span>
      </div>
    </div>

    <!-- Stats Grid Compact -->
    <div class="stats-grid-compact">
      <!-- 1. Required Hours (REQ) -->
      <div class="stat-card-compact">
        <mat-icon class="stat-icon-compact">schedule</mat-icon>
        <div class="stat-data-compact">
          <span class="stat-label-compact">REQ</span>
          <span class="stat-value-compact">{{ getRequiredHoursDisplay() }}</span>
        </div>
      </div>

      <!-- 2. Shortfall Hours (DEF) or Excess Hours (SUR) -->
      <div class="stat-card-compact" [ngClass]="getDefSurClass()">
        <mat-icon class="stat-icon-compact">{{ getDefSurIcon() }}</mat-icon>
        <div class="stat-data-compact">
          <span class="stat-label-compact">{{ getDefSurLabel() }}</span>
          <span class="stat-value-compact">{{ getDefSurValue() }}</span>
        </div>
      </div>

      <!-- 3. When To Exit (WTE) -->
      <div class="stat-card-compact info">
        <mat-icon class="stat-icon-compact">schedule</mat-icon>
        <div class="stat-data-compact">
          <span class="stat-label-compact">WTE</span>
          <span class="stat-value-compact">{{ getWteDisplay() }}</span>
        </div>
      </div>

      <!-- 4. Working Status (STS) -->
      <div class="stat-card-compact" [ngClass]="getWorkingStatusClass()">
        <mat-icon class="stat-icon-compact">{{ getWorkingStatusIcon() }}</mat-icon>
        <div class="stat-data-compact">
          <span class="stat-label-compact">STS</span>
          <span class="stat-value-compact">{{ getWorkingStatusValue() }}</span>
        </div>
      </div>
    </div>

    <!-- Activity Timeline -->
    <div class="cp-card graph-container-compact">
      <div class="graph-header-compact">
        <mat-icon class="graph-icon-compact">timeline</mat-icon>
        <span class="graph-title-compact">ACTIVITY TIMELINE</span>
        <button mat-icon-button 
                class="scroll-to-now-btn"
                (click)="scrollToCurrentTime()"
                *ngIf="processedSwipes && processedSwipes.length > 0"
                matTooltip="Scroll to current time">
          <mat-icon>my_location</mat-icon>
        </button>
      </div>
      <div class="timeline-scroll-container" 
           #timelineContainer
           *ngIf="processedSwipes && processedSwipes.length > 0">
        <svg class="swipe-timeline-graph" [attr.viewBox]="'0 0 ' + graphWidth + ' ' + graphHeight" preserveAspectRatio="none">
          <!-- X-axis grid lines (time) -->
          <g class="time-grid">
            <line *ngFor="let hour of timeHours" 
                  [attr.x1]="getHourPosition(hour)" 
                  [attr.y1]="0" 
                  [attr.x2]="getHourPosition(hour)" 
                  [attr.y2]="graphHeight"
                  class="grid-line-vertical"/>
          </g>
          
          <!-- X-axis labels (time) -->
          <g class="time-labels">
            <text *ngFor="let hour of timeHours" 
                  [attr.x]="getHourPosition(hour)" 
                  [attr.y]="graphHeight - 5"
                  class="time-label"
                  text-anchor="middle">{{ formatHourLabel(hour) }}</text>
          </g>
          
          <!-- Main timeline line -->
          <line [attr.x1]="0"
                [attr.y1]="graphHeight / 2"
                [attr.x2]="graphWidth"
                [attr.y2]="graphHeight / 2"
                class="timeline-base-line"/>
          
          <!-- Activity segments (working periods) -->
          <g class="activity-segments">
            <line *ngFor="let segment of activitySegments"
                  [attr.x1]="segment.startX"
                  [attr.y1]="graphHeight / 2"
                  [attr.x2]="segment.endX"
                  [attr.y2]="graphHeight / 2"
                  class="activity-segment-line"/>
          </g>
          
          <!-- Hours labels between swipes -->
          <g class="hours-labels-between">
            <g *ngFor="let swipe of processedSwipes; let i = index">
              <!-- IN hours: between IN and OUT (show after OUT swipe) -->
              <g *ngIf="swipe.indicator === 0 && swipe.sessionHours && i > 0">
                <text [attr.x]="(processedSwipes[i-1].x + swipe.x) / 2"
                      [attr.y]="graphHeight / 2 - 25"
                      class="hours-between-label hours-in-label"
                      text-anchor="middle">{{ swipe.sessionHours }}</text>
              </g>
              <!-- OUT hours: between OUT and IN (show after IN swipe) -->
              <g *ngIf="swipe.indicator === 1 && swipe.sessionHours && i > 0">
                <text [attr.x]="(processedSwipes[i-1].x + swipe.x) / 2"
                      [attr.y]="graphHeight / 2 + 25"
                      class="hours-between-label hours-out-label"
                      text-anchor="middle">{{ swipe.sessionHours }}</text>
              </g>
            </g>
          </g>
          
          <!-- Swipe markers with stick figures -->
          <g class="swipe-markers">
            <g *ngFor="let swipe of processedSwipes; let i = index"
               (mouseenter)="onSwipeHover(swipe, $event)"
               (mouseleave)="onSwipeLeave()">
              
              <!-- Stick figure for IN (walking in door) -->
              <g *ngIf="swipe.indicator === 1" class="stick-figure-in">
                <!-- Door frame -->
                <rect [attr.x]="swipe.x - 15"
                      [attr.y]="graphHeight / 2 - 40"
                      [attr.width]="30"
                      [attr.height]="50"
                      class="door-frame"
                      fill="none"
                      stroke="var(--cp-border)"
                      stroke-width="2"/>
                <line [attr.x1]="swipe.x - 15"
                      [attr.y1]="graphHeight / 2 - 10"
                      [attr.x2]="swipe.x + 15"
                      [attr.y2]="graphHeight / 2 - 10"
                      class="door-threshold"
                      stroke="var(--cp-border)"
                      stroke-width="2"/>
                
                <!-- Stick figure body -->
                <circle [attr.cx]="swipe.x"
                        [attr.cy]="graphHeight / 2 - 30"
                        [attr.r]="4"
                        class="stick-head"
                        fill="var(--cp-success)"/>
                <line [attr.x1]="swipe.x"
                      [attr.y1]="graphHeight / 2 - 26"
                      [attr.x2]="swipe.x"
                      [attr.y2]="graphHeight / 2 - 10"
                      class="stick-body"
                      stroke="var(--cp-success)"
                      stroke-width="2"/>
                <line [attr.x1]="swipe.x"
                      [attr.y1]="graphHeight / 2 - 18"
                      [attr.x2]="swipe.x - 6"
                      [attr.y2]="graphHeight / 2 - 10"
                      class="stick-arm-left"
                      stroke="var(--cp-success)"
                      stroke-width="2"/>
                <line [attr.x1]="swipe.x"
                      [attr.y1]="graphHeight / 2 - 18"
                      [attr.x2]="swipe.x + 6"
                      [attr.y2]="graphHeight / 2 - 10"
                      class="stick-arm-right"
                      stroke="var(--cp-success)"
                      stroke-width="2"/>
                <line [attr.x1]="swipe.x"
                      [attr.y1]="graphHeight / 2 - 10"
                      [attr.x2]="swipe.x - 5"
                      [attr.y2]="graphHeight / 2"
                      class="stick-leg-left"
                      stroke="var(--cp-success)"
                      stroke-width="2"/>
                <line [attr.x1]="swipe.x"
                      [attr.y1]="graphHeight / 2 - 10"
                      [attr.x2]="swipe.x + 5"
                      [attr.y2]="graphHeight / 2"
                      class="stick-leg-right"
                      stroke="var(--cp-success)"
                      stroke-width="2"/>
              </g>
              
              <!-- Stick figure for OUT (walking out door) -->
              <g *ngIf="swipe.indicator === 0" class="stick-figure-out">
                <!-- Door frame -->
                <rect [attr.x]="swipe.x - 15"
                      [attr.y]="graphHeight / 2 + 10"
                      [attr.width]="30"
                      [attr.height]="50"
                      class="door-frame"
                      fill="none"
                      stroke="var(--cp-border)"
                      stroke-width="2"/>
                <line [attr.x1]="swipe.x - 15"
                      [attr.y1]="graphHeight / 2 + 10"
                      [attr.x2]="swipe.x + 15"
                      [attr.y2]="graphHeight / 2 + 10"
                      class="door-threshold"
                      stroke="var(--cp-border)"
                      stroke-width="2"/>
                
                <!-- Stick figure body -->
                <circle [attr.cx]="swipe.x"
                        [attr.cy]="graphHeight / 2 + 30"
                        [attr.r]="4"
                        class="stick-head"
                        fill="var(--cp-secondary)"/>
                <line [attr.x1]="swipe.x"
                      [attr.y1]="graphHeight / 2 + 34"
                      [attr.x2]="swipe.x"
                      [attr.y2]="graphHeight / 2 + 50"
                      class="stick-body"
                      stroke="var(--cp-secondary)"
                      stroke-width="2"/>
                <line [attr.x1]="swipe.x"
                      [attr.y1]="graphHeight / 2 + 42"
                      [attr.x2]="swipe.x - 6"
                      [attr.y2]="graphHeight / 2 + 50"
                      class="stick-arm-left"
                      stroke="var(--cp-secondary)"
                      stroke-width="2"/>
                <line [attr.x1]="swipe.x"
                      [attr.y1]="graphHeight / 2 + 42"
                      [attr.x2]="swipe.x + 6"
                      [attr.y2]="graphHeight / 2 + 50"
                      class="stick-arm-right"
                      stroke="var(--cp-secondary)"
                      stroke-width="2"/>
                <line [attr.x1]="swipe.x"
                      [attr.y1]="graphHeight / 2 + 50"
                      [attr.x2]="swipe.x - 5"
                      [attr.y2]="graphHeight / 2 + 60"
                      class="stick-leg-left"
                      stroke="var(--cp-secondary)"
                      stroke-width="2"/>
                <line [attr.x1]="swipe.x"
                      [attr.y1]="graphHeight / 2 + 50"
                      [attr.x2]="swipe.x + 5"
                      [attr.y2]="graphHeight / 2 + 60"
                      class="stick-leg-right"
                      stroke="var(--cp-secondary)"
                      stroke-width="2"/>
              </g>
            </g>
          </g>
          
          <!-- Tooltip -->
          <g *ngIf="hoveredSwipe" class="tooltip-group">
            <rect [attr.x]="hoveredSwipe.x - 40"
                  [attr.y]="hoveredSwipe.y - 70"
                  [attr.width]="80"
                  [attr.height]="30"
                  class="tooltip-bg"
                  rx="4"/>
            <text [attr.x]="hoveredSwipe.x"
                  [attr.y]="hoveredSwipe.y - 52"
                  class="tooltip-type"
                  text-anchor="middle">{{ hoveredSwipe.type }}</text>
            <text [attr.x]="hoveredSwipe.x"
                  [attr.y]="hoveredSwipe.y - 40"
                  class="tooltip-time"
                  text-anchor="middle">{{ hoveredSwipe.time }}</text>
          </g>
        </svg>
      </div>
      <div class="graph-legend-compact" *ngIf="processedSwipes && processedSwipes.length > 0">
        <div class="legend-item">
          <span class="legend-text">Total: {{ getTotalHours() }}</span>
        </div>
      </div>
      <div class="no-data-compact" *ngIf="!processedSwipes || processedSwipes.length === 0">
        <mat-icon class="no-data-icon-compact">timeline</mat-icon>
        <span class="no-data-text-compact">NO DATA TO DISPLAY</span>
      </div>
    </div>

    <!-- Error State -->
    <div class="cp-card error-compact" *ngIf="(error$ | async) && !(loading$ | async)">
      <div class="error-header-compact">
        <mat-icon class="error-icon-compact">error_outline</mat-icon>
        <span class="error-title-compact">SYSTEM ERROR</span>
      </div>
      <div class="error-message-compact">
        {{ error$ | async }}
      </div>
      <div class="error-actions-compact">
        <button mat-raised-button class="retry-btn-compact" (click)="onRefresh()">
          <mat-icon>refresh</mat-icon>
          RETRY
        </button>
        <button mat-button class="dismiss-btn-compact" (click)="clearErrors()">
          <mat-icon>close</mat-icon>
          DISMISS
        </button>
      </div>
    </div>

    <!-- No Data State (when no error but no data) -->
    <div class="cp-card no-data-compact" *ngIf="!workHoursData && !(loading$ | async) && !(error$ | async)">
      <div class="no-data-header-compact">
        <mat-icon class="no-data-icon-compact">schedule</mat-icon>
        <span class="no-data-title-compact">NO DATA</span>
      </div>
      <div class="no-data-message-compact">
        No work hours data available for the selected date.
      </div>
      <button mat-raised-button class="retry-btn-compact" (click)="onRefresh()">
        <mat-icon>refresh</mat-icon>
        LOAD DATA
      </button>
    </div>


  </div>
</div>